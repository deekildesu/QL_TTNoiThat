use master
CREATE DATABASE QL_TrangTriNoiThat
USE QL_TrangTriNoiThat

------TẠO CÁC BẢNG

---------TẠO BẢNG NHÂN VIÊN
CREATE TABLE NHANVIEN
(
	MA_NHAN_VIEN	NVARCHAR(10)	NOT NULL,
	TEN_NHAN_VIEN	NVARCHAR(50)	NOT NULL,
	GIOI_TINH		NVARCHAR(10)	NOT NULL,
	DIA_CHI			NVARCHAR(200)	NOT NULL,
	DIEN_THOAI		NVARCHAR(15)	NOT NULL,
	NGAY_SINH		DATETIME		NOT NULL,
	MAT_KHAU		NVARCHAR(20)	 NULL,
	CONSTRAINT	PK_NHANVIEN	PRIMARY KEY (MA_NHAN_VIEN	ASC)
)
---------TẠO BẢNG KHÁCH HÀNG
CREATE TABLE KHACHHANG
(
	MA_KHACH_HANG	NVARCHAR(10) 	NOT NULL,
	TEN_KHACH_HANG	NVARCHAR(50)	NOT NULL,
	GIOI_TINH		NVARCHAR(10)	NOT NULL,
	DIA_CHI			NVARCHAR(200)	NOT NULL,
	DIEN_THOAI		NVARCHAR(50)	NOT NULL,
	EMAIL			NVARCHAR(200)	null,
	CONSTRAINT PK_KHACHHANG	PRIMARY KEY (MA_KHACH_HANG	ASC)
)
---------TẠO BẢNG HÓA ĐƠN BÁN HÀNG
CREATE TABLE HDBAN
(
	MA_HOA_DON_BAN		NVARCHAR(10)	NOT NULL,
	MA_NHAN_VIEN		NVARCHAR(10)	NOT NULL,
	NGAY_BAN			DATETIME		NOT NULL,
	MA_KHACH_HANG		NVARCHAR(10)	NOT NULL,
	CONSTRAINT PK_HOADONBANHANG PRIMARY KEY(MA_HOA_DON_BAN	ASC)
)
---------TẠO BẢNG MẶT HÀNG
CREATE TABLE MATHANG
(
	MA_MAT_HANG		NVARCHAR(10)	NOT NULL,
	TEN_MAT_HANG	NVARCHAR(255)	NOT NULL,
	SO_LUONG		FLOAT(53)		NOT NULL,
	DON_GIA_NHAP	FLOAT(53)		NOT NULL,
	DON_GIA_BAN		FLOAT(53)		NOT NULL,
	HINH			NVARCHAR(200)	NULL,
	GHI_CHU			NVARCHAR(200)	NULL	,
	CONSTRAINT PK_MATHANG	PRIMARY KEY(MA_MAT_HANG ASC)
)
---------TẠO BẢNG CHI TIẾT HÓA ĐƠN BÁN HÀNG
CREATE TABLE CTHDBAN
(
	MAHD		NVARCHAR(10)	NOT NULL,
	MA_HANG		NVARCHAR(10)	NOT NULL,
	SO_LUONG	FLOAT(53)		NOT NULL,
	DON_GIA	FLOAT(53)		NOT NULL,
	CONSTRAINT PK_CTHOADON	PRIMARY KEY(MAHD ASC, MA_HANG)
)
create table users
(
	taikhoan nvarchar(50) primary key,
	matkhau nvarchar(50) not null,
	phanquyen nvarchar(50) not null,

)
----TẠO CÁC KHÓA NGOẠI


ALTER TABLE  HDBAN		ADD CONSTRAINT PK_HOADONBANHANG_NHANVIEN	FOREIGN KEY (MA_NHAN_VIEN)	REFERENCES NHANVIEN(MA_NHAN_VIEN)
ALTER TABLE  HDBAN		ADD CONSTRAINT PK_HOADONBANHANG_KHACHHANG	FOREIGN KEY (MA_KHACH_HANG)	REFERENCES KHACHHANG(MA_KHACH_HANG)  
ALTER TABLE  CTHDBAN	ADD CONSTRAINT PK_CTHOADON_HOADONBAN		FOREIGN KEY (MAHD)			REFERENCES HDBAN(MA_HOA_DON_BAN) 
ALTER TABLE	 CTHDBAN	ADD CONSTRAINT PK_CTHOADON_MATHANG			FOREIGN KEY (MA_HANG)		REFERENCES MATHANG(MA_MAT_HANG)

-- set ngày tháng năm
SET DATEFORMAT DMY
-- THÊM DỮ LIỆU VÀO BẢNG
SELECT MA_NHAN_VIEN , TEN_NHAN_VIEN,GIOI_TINH, DIA_CHI,DIEN_THOAI, NGAY_SINH FROM NHANVIEN
INSERT INTO NHANVIEN VALUES (N'NV01',N'Quách Nhất Duy',N'Nam',N'Kp2, Hiệp bình chánh, quận Thủ Đức','083438906','15/01/1999','123456')
insert into NHANVIEN values(N'NV02',N'Trần Văn Tèo',N'Nam',N'755 Trần Duy Hưng quận 13 TP Hồ Chí Minh','0375025142',CONVERT(DATE,'11/10/1995',101),'')
insert into NHANVIEN values(N'NV03',N'Trần Duy Hưng',N'Nữ',N'123A Lâm Quang Ky,TP Rạch Giá','0347025266',CONVERT(DATE,'5/5/1999',101),'')
insert into NHANVIEN values(N'NV05',N'Đinh Công Mạnh',N'Nam',N'Ấp Cầu Đôi, xã Lai Hưng, Huyện Bàu Bàng, Tỉnh Bình Dương','1345487',CONVERT(DATE,'1/2/1989',101),'')
insert into NHANVIEN values(N'NV04',N'Lao Văn Phổi',N'Nam',N'Ấp Cầu Đôi, xã Lai Hưng, Huyện Bàu Bàng, Tỉnh Bình Dương','1345487',CONVERT(DATE,'1/24/1989',101),'')

---update
Update NHANVIEN  set TEN_NHAN_VIEN= N'ABCVD',GIOI_TINH=N'Nữ',DIA_CHI=N'Ấp Cầu Đôi, xã Lai Hưng, Huyện Bàu Bàng, Tỉnh Bình Dương', DIEN_THOAI='0347025266', NGAY_SINH= CONVERT(DATE,'5/29/2020',101), MAT_KHAU=''where MA_NHAN_VIEN='NV03'
--- THÊM DỮ LIỆU BẢNG KHÁCH HÀNG
select * from KHACHHANG
insert into KHACHHANG values(N'KH01',N'Phương',N'Nam',N'Bình Dương','0123456789',N'Phuong@gmail.com')
insert into KHACHHANG values(N'KH02',N'Nam',N'Nam',N'Bình Dương','0123456789',N'Nam@gmail.com')
insert into KHACHHANG values(N'KH04',N'Nữ',N'Nam',N'Bình Dương','0123456789',N'Nữ@gmail.com')
---THÊM DỮ LIỆU SẢN PHẨM
SELECT * FROM MATHANG
insert into MATHANG values(N'ĐB-001',N'Đèn bàn 1',100,199000,200000,'',N'không bán lẻ')
insert into MATHANG values(N'G-01',N'Giường cao su 1',10,500000,,'',N'Không bán lẻ')
insert into MATHANG values(N'ĐN-01',N'Đèn ngủ cao cấp 1',20,150000,300000,'',N'Không bán lẻ');

-- thêm dữ liệu bảng hóa đơn
select MA_HOA_DON_BAN, nv.TEN_NHAN_VIEN, kh.TEN_KHACH_HANG, NGAY_BAN from HDBAN hd , NHANVIEN nv, KHACHHANG kh where kh.MA_KHACH_HANG = hd.MA_KHACH_HANG and nv.MA_NHAN_VIEN = hd.MA_NHAN_VIEN
insert into HDBAN values (N'HD-0001',N'NV01',N'25/1/2019',N'KH01')
insert into HDBAN values (N'HD-0002',N'NV01',CONVERT(DATE,'5/5/2019',101), N'KH01')
insert into HDBAN values (N'HD-0003',N'NV02',CONVERT(DATE,'5/5/2019',101), N'KH02')
 
select cthd.MAHD, sp.TEN_MAT_HANG SANPHAM, cthd.SO_LUONG, cthd.DON_GIA from CTHDBAN cthd, MATHANG sp where cthd.MA_HANG = sp.MA_MAT_HANG 
insert into CTHDBAN values (N'HD-0001',N'ĐB-001',1,200000)
insert into CTHDBAN values (N'HD-0002',N'G-01',3,1500000)
insert into CTHDBAn values (N'HD-0003',N'ĐN-01',3,300000)



Delete CTHDBAN where MAHD = N'HD-0001'
insert into users values ('admin','admin','Admin')
select * from users where taikhoan=N'admin' and matkhau=N'admin'
--Hiển thị tên khách hàng và nhân viên thông qua câu lệnh truy vấn
select hd.MA_HOA_DON_BAN, hd.NGAY_BAN, nv.TEN_NHAN_VIEN, kh.TEN_KHACH_HANG from HDBAN hd,KHACHHANG kh, NHANVIEN nv
where kh.MA_KHACH_HANG = hd.MA_KHACH_HANG and hd.MA_NHAN_VIEN =nv.MA_NHAN_VIEN
select ct.MAHD,mh.TEN_MAT_HANG, ct.SO_LUONG,ct.DON_GIA from CTHDBAN ct, MATHANG mh
where ct.MA_HANG= mh.MA_MAT_HANG
select * from HDBAN
